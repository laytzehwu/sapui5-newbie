sap.ui.define([
	"sap/ui/core/mvc/Controller",
	"sap/ui/model/json/JSONModel"
], function(Controller, JSONModel) {
	"use strict";
	return Controller.extend("newbies.controller.welcome", {
		onInit: function() {
			//this.oUserModel = new JSONModel("/services/userapi/currentUser");
			this.oUserModel = new JSONModel();
			var me = this;
			this.oUserModel.attachRequestCompleted(function() {
				// this is referring oUserModel not the controller
				me.doSomethingWhenUserDataIsRead();
			});
			this.getView().setModel(this.oUserModel, "user");
			//console.log("See what we have in the model", this.oUserModel.getData());
			var oWeatherInputModel = new JSONModel();
			oWeatherInputModel.setData({
				city: "Ipoh",
				weather: ""
			});
			this.getView().setModel(oWeatherInputModel, "w");
			var oWeatherOutputModel = new JSONModel();
			this.getView().setModel(oWeatherOutputModel, "wo");
			
			oWeatherOutputModel.attachRequestCompleted(function () {
				var oData = this.getData();
				//console.log(oData.weather[0].description);
				var oOutData = oWeatherInputModel.getData();
				oOutData.weather = oData.weather[0].description;
				oWeatherInputModel.setData(oOutData);
			});
		},
		doSomethingWhenUserDataIsRead: function() {
			//console.log("Data is here after request complted", this.oUserModel.getData());
		},
		doShowMyName: function() {
			this.oUserModel.loadData("/services/userapi/currentUser");
		},
		/**
		 *@memberOf newbies.controller.welcome
		 */
		getCityDetail: function() {
			//This code was generated by the layout editor.
			var oInModel = this.getView().getModel("w");
			//console.log("User enter:" , oModel.getData());
			var oInData = oInModel.getData();
			var oOutModel = this.getView().getModel("wo");
			oOutModel.loadData("/services/weather?appid=6cdea36f4d3f8b2408dd611232fa114f&q=" + oInData["city"]);
		}
	});
});